<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parcel Buddy — PHP MVC Delivery System | Meredith Cooper</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="book-header">
    <h1>Parcel Buddy</h1>
    <p>Client Server Systems Assignment (Level 5) — PHP MVC Delivery Management System</p>
  </header>
  <main class="container">
    <!-- INTRO SECTION -->
    <section class="intro">
      <p><strong>Parcel Buddy</strong> is a web-based parcel delivery management system built using the
      <strong>Model–View–Controller (MVC)</strong> pattern. It allows managers to assign parcels to drivers
      and delivery staff to update parcel status, view routes, and interact with real-time maps.</p>
      <img src="images/parcel-login.png" alt="Parcel Buddy Login Page" class="project-image">
      <p style="text-align:center; font-size:0.9rem; color:#666;">(Login page preview – placeholder image)</p>
    </section>
    <!-- TECH STACK -->
    <section>
      <h2>Tech Stack</h2>
      <div class="tech-badges">
        <span class="badge">PHP (OOP, MVC)</span>
        <span class="badge">MySQL</span>
        <span class="badge">PDO</span>
        <span class="badge">JavaScript (AJAX)</span>
        <span class="badge">Leaflet.js</span>
        <span class="badge">HTML/CSS</span>
        <span class="badge">Bootstrap</span>
      </div>
    </section>
    <!-- FEATURES -->
    <section>
      <h2>Key Features</h2>
      <ul>
        <li>Secure login system with <strong>role-based navigation</strong> (Manager / Deliverer).</li>
        <li>CRUD operations with <strong>PHP Data Objects (PDO)</strong> and prepared statements.</li>
        <li><strong>Live search</strong> with AJAX and server-side filtering.</li>
        <li><strong>Leaflet.js map integration</strong> displaying live delivery locations.</li>
        <li>QR code generation for parcel identification and scanning workflow.</li>
      </ul>
    </section>
    <!-- CODE SAMPLES -->
    <section>
      <h2>Highlighted Code Samples</h2>
      <details>
        <summary>Database Singleton Connection <code>(Database.php)</code></summary>
        <pre><code>class Database {
  protected static $_dbInstance = null;
  protected $_dbHandle;
  public static function getInstance() {
    $username ='example';
    $password = 'example';
    $host = 'example.host';
    $dbName = 'exampledb';
    if(self::$_dbInstance === null) {
      self::$_dbInstance = new self($username, $password, $host, $dbName);
    }
    return self::$_dbInstance;
  }
  private function __construct($username, $password, $host, $database) {
    try {
      $this->_dbHandle = new PDO("mysql:host=$host;dbname=$database",
        $username, $password);
    } catch (PDOException $e) {
      echo $e->getMessage();
    }
  }
  public function getdbConnection() {
    return $this->_dbHandle;
  }
}</code></pre>
      </details>
      <details>
        <summary>Fetching + Filtering Data Securely <code>(DeliveryPointDataSet.php)</code></summary>
        <pre><code>public function searchDeliveryPointsByField($searchField, $searchValue) {
  $validFields = ['name', 'postcode', 'address_1', 'id'];
  if (!in_array($searchField, $validFields)) {
    throw new InvalidArgumentException('Invalid search field.');
  }
  $sql = "SELECT * FROM delivery_point WHERE $searchField LIKE :searchValue";
  $stmt = $this->_dbHandle->prepare($sql);
  $stmt->bindValue(':searchValue', '%' . $searchValue . '%', PDO::PARAM_STR);
  $stmt->execute();
  $dataSet = [];
  while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    $dataSet[] = new DeliveryPointData($row);
  }
  return $dataSet;
}</code></pre>
      </details>
      <details>
        <summary>Login Controller with Role-Based Redirection <code>(logincontroller.php)</code></summary>
        <pre><code>if (isset($_POST["loginbutton"])) {
  $db = Database::getInstance();
  $username = $_POST["username"];
  $password = $_POST["password"];
  $sqlQuery = 'SELECT usertype, userid FROM delivery_users
               WHERE username=:username AND password=:password';
  $stmt = $db->getdbConnection()->prepare($sqlQuery);
  $stmt->bindParam(':username', $username);
  $stmt->bindParam(':password', $password);
  $stmt->execute();
  $result = $stmt->fetch(PDO::FETCH_ASSOC);
  if ($result) {
    $_SESSION["login"] = $username;
    $_SESSION["userid"] = $result['userid'];
    if ($result['usertype'] === 'Manager') {
      header('Location: managerPage.php');
    } elseif ($result['usertype'] === 'Deliverer') {
      header('Location: userPage.php');
    }
  } else {
    echo "Invalid login credentials.";
  }
}</code></pre>
      </details>
      <details>
        <summary>Interactive Map Using Leaflet.js <code>(userPage.phtml)</code></summary>
        <pre><code>var map = L.map('map').setView([53.4576, -2.2426], 10);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);
<?php foreach ($userDeliveryPointDataSet as $point): ?>
L.marker([<?= $point->getLat(); ?>, <?= $point->getLng(); ?>])
  .addTo(map)
  .bindPopup(`<b><?= $point->getName(); ?></b><br>Status: <?= $point->getStatus(); ?>`);
<?php endforeach; ?></code></pre>
      </details>
    </section>
    <p style="text-align:center; margin-top:2rem;">
      <a href="index.html">&larr; Back to Portfolio</a>
    </p>
  </main>
  <footer class="book-footer">
    <p>Parcel Buddy – Client Server Systems Assignment</p>
  </footer>
</body>
</html>
